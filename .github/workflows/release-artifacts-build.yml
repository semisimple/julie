name: Release Builds
on:
  push:
    tags:
      - v3*
      - v4*
jobs:
  package_build:
    name: Build rpm/deb packages (using maven)
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Import public GPG Key
        run: rpm --import release/keys/public.key
      - name: Set up the JDK
        uses: actions/setup-java@v4
        with:
          java-version: 11
          distribution: "temurin"
          cache: maven
      - name: Build with Maven
        run: mvn -B package --file pom.xml
      - name: Build the rpm
        run: mvn rpm:rpm
      - uses: actions/upload-artifact@v4
        with:
          name: RPM package
          path: target/rpm/julie-ops/RPMS/noarch/*.rpm
      - uses: actions/upload-artifact@v4
        with:
          name: DEB package
          path: target/*.deb
      - uses: actions/upload-artifact@v4
        with:
          name: FAT jar
          path: target/julie-ops.jar
